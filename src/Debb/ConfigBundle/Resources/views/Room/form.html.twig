{% set exportasarchive = true %}
{% extends "DebbManagementBundle::form.html.twig" %}
{% form_theme form "DebbManagementBundle::form_theme.html.twig" %}

{% block stylesheets %}
	{{ parent() }}
	{% stylesheets filter='cssrewrite'
		'bundles/debbconfig/css/jquery-ui.min.css'
	%}
		<link href="{{ asset_url }}" type="text/css" rel="stylesheet" />
	{% endstylesheets %}
	<style>
		ul.hoz { list-style-type: none; margin: 0; padding: 0; margin-bottom: 10px; }
		li.hoz { margin: 5px; padding: 5px; width: 150px; }
	</style>
{% endblock %}

{% block javascripts %}
	{{ parent() }}
	{% javascripts
		'@DebbConfigBundle/Resources/public/js/jquery-ui.min.js'
		'@DebbConfigBundle/Resources/public/js/room.js'
	%}
		<script src="{{ asset_url }}" type="text/javascript"></script>
	{% endjavascripts %}
	<script type="text/javascript">
		var roomId = {{ form.vars.data.id | default(0) }};
	</script>
{% endblock %}

{% if form.vars.data.sizeX|default(0) < 1 %}{% set rackSizeX = 900 %}{% else %}{% set rackSizeX = form.vars.data.sizeX %}{% endif %}
{% if form.vars.data.sizeY|default(0) < 1 %}{% set rackSizeY = 700 %}{% else %}{% set rackSizeY = form.vars.data.sizeY %}{% endif %}

{% block contentExtras %} style="width: {{ rackSizeX + 21 }}px;"{% endblock %}

{% block content %}
	<div style="margin-left: 6px;">
		{{ form_row(form.building) }}
		{{ form_row(form.name) }}
		<div>
			{{ 'Add rack' | trans }}:
			<ul class="hoz">
				{% for rack in racks %}
					<li class="hoz ui-state-default eDraftRack" style="margin-left: 0px; margin-right: 10px;"><div class="draftRack" rackId="{{ rack.id }}" rackX="{{ rack.fullx }}" rackY="{{ rack.fully }}" rackZ="{{ rack.fullz }}" title="{{ rack | e }}">{{ rack }}</div></li>
				{% endfor %}
			</ul>
		</div>
		<div class="clear"></div>
		<div id="rackSize">{{ 'size' | trans }}: <span id="rackSizeX">{{ (rackSizeX / 100.0) | number_format(2, '.', '') }}</span>m x <span id="rackSizeY">{{ (rackSizeY / 100.0) | number_format(2, '.', '') }}</span>m</div>
		<div id="rackContainer" style="position: relative; width: {{ rackSizeX }}px; height: {{ rackSizeY }}px; border: 2px solid #000; background: url('{{ asset('bundles/debbconfig/img/room-grid.png') }}') repeat scroll 1px {{ rackSizeY + 1 }}px transparent;" data-prototype="{{ form_row(form.racks.vars.prototype) | escape }}">
			{% for rack in form.racks %}
				{%- set rackRot -%}
					{%- spaceless -%}
						{% if rack.vars.data.rotation|default() is not empty %}
							{% if rack.vars.data.rotation > 0 and rack.vars.data.rotation < 91 %}
								left
							{% elseif rack.vars.data.rotation > 90 and rack.vars.data.rotation < 181 %}
								up
							{% elseif rack.vars.data.rotation > 180 and rack.vars.data.rotation < 271 %}
								right
							{% else %}
								down
							{% endif %}
						{% else %}
							down
						{% endif %}
					{%- endspaceless -%}
				{%- endset -%}
				<div class="rackG" posx="{{ rack.vars.data.posx }}" posy="{{ rack.vars.data.posy }}" posz="{{ rack.vars.data.posz }}"
				     rackId="{{ rack.vars.data.id }}" title="{{ rack.vars.data.rack | e }}" rackX="{{ rack.vars.data.rack.fullx }}" rackY="{{ rack.vars.data.rack.fully }}" rackZ="{{ rack.vars.data.rack.fullz }}"><a href="#" class="removeRack"><i class="icon-trash"></i></a> - <a href="#" class="rotateRack"><i class="icon-arrow-{{ rackRot }}"></i></a><br />{{ rack.vars.data.rack }}
					<div class="rackGform" style="display: none;">
						{{ form_widget(rack) }}
					</div>
				</div>
			{% endfor %}
		</div>
		<div class="clear"></div>
		<div id="rackScale"><i class="icon-arrow-left"></i> {{ 'Scale' | trans }} 1m <i class="icon-arrow-right"></i></div>

		{{ form_widget(form._token) }}
		{{ form_rest(form) }}
		<div class="clear"></div>
	</div>
{% endblock %}
